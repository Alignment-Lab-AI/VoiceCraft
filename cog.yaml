# Configuration for Cog ⚙️
# Reference: https://github.com/replicate/cog/blob/main/docs/yaml.md

build:
  gpu: true
  system_packages:
    - "libgl1-mesa-glx"
    - "libglib2.0-0"
    - ffmpeg
    - espeak-ng
  python_version: "3.9.16"
  python_packages:
    - torch==2.0.1
    - torchaudio==2.0.2 
    - xformers==0.0.22
    - tensorboard==2.16.2
    - phonemizer==3.2.1
    - datasets==2.16.0
    - torchmetrics==0.11.1
    - whisperx==3.1.1
    - openai-whisper>=20231117
  run:
    - curl -O https://repo.anaconda.com/miniconda/Miniconda3-py310_23.3.1-0-Linux-x86_64.sh
    - bash Miniconda3-py310_23.3.1-0-Linux-x86_64.sh -b -p /cog/miniconda
    - /cog/miniconda/bin/conda init bash
    - /bin/bash -c "source /cog/miniconda/bin/activate && conda create -n myenv python=3.9.16 -y"
    - /bin/bash -c "source /cog/miniconda/bin/activate && conda activate myenv && conda install -c conda-forge montreal-forced-aligner=2.2.17 openfst=1.8.2 kaldi=5.5.1068 -y"
    - /bin/bash -c "source /cog/miniconda/bin/activate && conda activate myenv && mfa model download dictionary english_us_arpa &&  mfa model download acoustic english_us_arpa"
    - export PATH=/cog/miniconda/envs/myenv/bin:$PATH
    - git clone https://github.com/facebookresearch/audiocraft && pip install -e ./audiocraft
    - pip install "pydantic<2.0.0"
    - curl -o /usr/local/bin/pget -L "https://github.com/replicate/pget/releases/download/v0.6.0/pget_linux_x86_64" && chmod +x /usr/local/bin/pget
predict: "predict.py:Predictor"